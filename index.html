<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MindAR Camera Permission Test</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      font-family: monospace;
      color: #00ffcc;
      overflow: hidden;
    }

    #log {
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      max-height: 50%;
      overflow-y: auto;
      background: rgba(0,0,0,0.8);
      padding: 10px;
      border-radius: 8px;
      font-size: 13px;
      z-index: 9999;
      white-space: pre-wrap;
    }

    #tap {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #00ffcc;
      color: black;
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 14px;
      z-index: 9999;
    }
  </style>

  <!-- MindAR NON-module build (required for plain HTML) -->
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.min.js"></script>
</head>

<body>
  <div id="log">üü° Page loaded\n</div>
  <div id="tap">Tap once to start AR</div>

  <script>
    const logBox = document.getElementById("log");

    function log(msg) {
      console.log(msg);
      logBox.textContent += msg + "\n";
      logBox.scrollTop = logBox.scrollHeight;
    }

    // Catch ANY JS error
    window.onerror = function (msg, src, line, col, err) {
      log("‚ùå JS ERROR: " + msg + " (line " + line + ")");
    };

    async function startAR() {
      log("üëÜ User tap detected");

      // Check browser support
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        log("‚ùå getUserMedia NOT supported");
        return;
      }
      log("‚úÖ getUserMedia supported");

      // Check MindAR loaded
      if (!window.MINDAR) {
        log("‚ùå MindAR library NOT loaded");
        return;
      }
      log("‚úÖ MindAR library loaded");

      let mindar;
      try {
        mindar = new MINDAR.IMAGE.MindARThree({
          container: document.body,
          imageTargetSrc: "targets.mind"
        });
        log("‚úÖ MindAR instance created");
      } catch (e) {
        log("‚ùå Failed to create MindAR instance");
        return;
      }

      try {
        log("üì∑ Requesting CAMERA permission...");
        await mindar.start();
        log("üü¢ CAMERA STARTED (permission granted)");
      } catch (e) {
        log("‚ùå CAMERA FAILED TO START");
        log("üëâ Possible reasons:");
        log("‚Ä¢ Permission blocked");
        log("‚Ä¢ targets.mind not found");
        log("‚Ä¢ Browser restriction");
        return;
      }
    }

    // REQUIRED user gesture
    document.body.addEventListener("click", startAR, { once: true });
  </script>
</body>
</html>
